<main class="h-full pb-16 overflow-y-auto">
  <style>
    @media only screen and (min-width: 1000px){
       #cards {
        display: grid;
        grid-template-columns: auto auto auto;
    }
    }
    .tableFixHead {
        overflow-y: auto; /* make the table scrollable if height is more than 200 px  */
        height: 200px; /* gives an initial height of 200px to the table */
      }
    .tableFixHead thead th {
        position: sticky; /* make the table heads sticky */
        top: 0px; /* table head will be placed from the top of the table and sticks to it */
      }
      table {
        border-collapse: collapse; /* make the table borders collapse to each other */
        width: 100%;
      }
      th,
      td {
        padding: 8px 16px;
        border: 1px solid #ccc;
      }
      th {
        background: #eee;
      }
  </style>

  <div class="container px-6 mx-auto grid">
    <!-- Responsive cards -->
    <h4 class="mb-4 text-lg font-semibold text-gray-600 dark:text-gray-300 py-3">
      Overview
    </h4>
    <div class="grid gap-6 mb-8 md:grid-cols-3 xl:grid-cols-4"id="cards">
      <!-- Card -->
      <div class="flex items-center p-3 bg-white rounded-lg shadow-xs dark:bg-gray-800">
        <div class="p-3 mr-4 text-orange-500 bg-orange-100 rounded-full dark:text-orange-100 dark:bg-orange-500">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z">
            </path>
          </svg>
        </div>
      <div>
          <div class="mb-2 text-sm font-medium text-gray-600 dark:text-gray-400" style="display: flex;justify-content:space-between">
            <p>Processe Albums</p>  <p style="font-size: 20px;margin-" id ="processed-album">0</p>
          </div>
          <p class="text-lg font-semibold text-gray-700 dark:text-gray-200">
            <a href="/album-submitted" style="color:#7e3af2;margin-left: 18px;font-size: initial;">Check Submitted &#8594</a>
          </p>  
        </div>
    </div>
      <!-- Card -->
      <div  class="flex items-center p-3 bg-white rounded-lg shadow-xs dark:bg-gray-800">
        <div class="p-3 mr-4 text-green-500 bg-green-100 rounded-full dark:text-green-100 dark:bg-green-500">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd"
              d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z"
              clip-rule="evenodd"></path>
          </svg>
        </div>
        <div>
          <div class="mb-2 text-sm font-medium text-gray-600 dark:text-gray-400" style="display: flex;justify-content:space-between">
             <p>Finalised Albums</p>
             <p style="font-size: 20px;margin-" id ="final-album">0</p>
          </div>
          <p class="text-lg font-semibold text-gray-700 dark:text-gray-200">
             <a href="/completes"style="color:#7e3af2;margin-left: 18px;font-size: initial;">Check Completed &#8594</a>
          </p>
        </div>
      </div>
       <!-- Card -->
      <div  class="flex items-center p-3 bg-white rounded-lg shadow-xs dark:bg-gray-800">
        <div class="p-3 mr-4 text-green-500 bg-green-100 rounded-full dark:text-green-100 dark:bg-green-500">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd"
              d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z"
              clip-rule="evenodd"></path>
          </svg>
        </div>
        <div>
          <div class="mb-2 text-sm font-medium text-gray-600 dark:text-gray-400" style="display: flex;justify-content:space-between">
             <p>Total Album</p>
             <p style="font-size: 20px;margin-" id ="total-album">0</p>
          </div>
          <p class="text-lg font-semibold text-gray-700 dark:text-gray-200">
             <a href="/drafts"style="color:#7e3af2;margin-left: 18px;font-size: initial;">Check Drafts &#8594</a>
          </p>
        </div>
      </div>
</div>
{{!-- news table --}}
<div class="grid gap-6 mb-8 md:grid-cols-2 xl:grid-cols-3">
    <div class="w-full mb-8 overflow-hidden rounded-lg shadow-xs">
      <h4 class="text-lg font-semibold text-gray-600 dark:text-gray-300 py-2 text-center">
      News
    </h4>
      <div class="w-full overflow-x-auto tableFixHead">
        <table class="w-full whitespace-no-wrap">
          <thead>
           <tr>
            <th>Discription</th>
            <th>Priority</th>
          </tr>
          </thead>
          <tbody class="bg-white divide-y dark:divide-gray-700 dark:bg-gray-800" id ="showNews">
          </tbody>
        </table>
      </div>
</div>

{{!-- editing block --}}
    <div class="w-full mb-8 overflow-hidden rounded-lg shadow-xs">
      <h4 class="text-lg font-semibold text-gray-600 dark:text-gray-300 py-2 text-center">
      Correction Requests
    </h4>
      <div class="w-full overflow-x-auto tableFixHead">
        <table class="w-full whitespace-no-wrap">
          <thead>
          <tr>
            <th>Albums 	&#38; Labels</th>
          </tr>
          </thead>
          <tbody class="bg-white divide-y dark:divide-gray-700 dark:bg-gray-800" id = "correctionDataFill">
          
          </tbody>
        </table>
      </div>
  </div>

  {{!-- drafts --}}
  <div class="w-full mb-8 overflow-hidden rounded-lg shadow-xs">
      <div class="w-full overflow-x-auto tableFixHead">
        <table class="w-full whitespace-no-wrap">
          <thead>
            <tr
              class="text-xs font-semibold tracking-wide text-left text-gray-500 uppercase border-b dark:border-gray-700 bg-gray-50 dark:text-gray-400 dark:bg-gray-800">
              <th class="px-4 py-3 text-center" >&#xf080;	Drafts 
                <button
                style="float: right;"
                 class="px-2 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-purple-600 border border-transparent rounded-md active:bg-purple-600 hover:bg-purple-700 focus:outline-none focus:shadow-outline-purple">
                 {{data.draft_count}}
                </button>
              </th>         
            </tr>
          </thead>
          <tbody id ="draftDataFill" class="bg-white divide-y dark:divide-gray-700 dark:bg-gray-800">
            
            
          </tbody>
        </table>
      </div>
  </div>
  <div class="w-full mb-4 overflow-hidden rounded-lg shadow-xs" style="height: 200px;">
      <div class="w-full overflow-x-auto">
        <table class="w-full whitespace-no-wrap">
          <thead>
            <tr
              class="text-xs font-semibold tracking-wide text-left text-gray-500 uppercase border-b dark:border-gray-700 bg-gray-50 dark:text-gray-400 dark:bg-gray-800">
              <th class="px-4 py-3"><i class="fa fa-credit-card" style="font-size:15px"></i> payments <a href="" style="float: right;"><i class="fa fa-refresh" style="font-size:20px"></i></a></th>         
            </tr>
          </thead>
          <tbody class="bg-white divide-y dark:divide-gray-700 dark:bg-gray-800">
            <tr class="text-gray-700 dark:text-gray-400">
              <td class="px-4 py-3" style="text-align: center;">
                    <button
                    class="px-4 py-2 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-purple-600 border border-transparent rounded-lg active:bg-purple-600 hover:bg-purple-700 focus:outline-none focus:shadow-outline-purple">
                     payment
                    </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
  </div>
</div>
</div>
</main>


<script>
  let DraftArray = []
  let news = []
  let userData ={}
  function cleanNullValues() {
    for (let i = 0; i < DraftArray.length; i++) {
      if (DraftArray[i].title == null) DraftArray[i].title = ""
      if (DraftArray[i].labelName == null) DraftArray[i].labelName = ""
      if (DraftArray[i].originalReleaseDate == null) DraftArray[i].originalReleaseDate = ""
    }
  }
  function updateTableOfCorrection(){
     document.getElementById("correctionDataFill").innerHTML = ``
      for (let i = 0; i < DraftArray.length; i++) {
        if(!DraftArray[i].submitted) continue
        document.getElementById("correctionDataFill").innerHTML += `
          <tr class="text-gray-700 dark:text-gray-400">
              <td class="px-4 py-3">
                <a href ="/draft-release/${DraftArray[i].id}"
                    style="float:right ;"
                    class="flex items-center justify-between px-2 py-2 text-sm font-sm leading-5 text-white transition-colors duration-150 bg-purple-600 border border-transparent rounded-full active:bg-purple-600 hover:bg-purple-700 focus:outline-none focus:shadow-outline-purple"
                    aria-label="Edit">
                    <svg class="w-3 h-3" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20">
                    <path
                     d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z">
                    </path>
                    </svg>
                </a>
                <div class="flex items-center text-sm">
                  <!-- Avatar with inset shadow -->
                  <p style="font-size: 20px;margin-inline:20px">&#10061;</p>
                  <div>
                    <p>${DraftArray[i].title}</p>
                    <p class="text-xs text-gray-600 dark:text-gray-400">
                      ${DraftArray[i].createdAt}
                    </p>
                  </div>
                </div>
              </td>
            </tr>`
     }
  }
  function updateTableData() {
    cleanNullValues()
    DraftArray.sort(function (a, b) {
      return a.id - b.id;
    });
    document.getElementById("draftDataFill").innerHTML = ``
    for (let i = 0; i < DraftArray.length; i++) {
      document.getElementById("draftDataFill").innerHTML += `
      <tr class="text-gray-700 dark:text-gray-400">
              <td class="px-4 py-3">
                <div class="flex items-center text-sm">
                  <!-- Avatar with inset shadow -->
                  <p style="font-size: 20px;margin-inline:20px">&#10061;</p>
                  <div>
                    <p class="text-xs text-gray-600 dark:text-gray-400">
                     ${DraftArray[i].title} Last Updated on ${DraftArray[i].updatedAt}
                    </p>
                  </div>
                </div>
              </td>
            </tr>`
    }
  }
  function updateNews(){
    for(let i =0;i<news.length;i++){
    document.getElementById("showNews").innerHTML +=
      `<tr class="text-gray-700 dark:text-gray-400">
              <td class="px-4 py-3">
                <div class="flex items-center text-sm">
                  <!-- Avatar with inset shadow -->
                  <div class="relative hidden w-8 h-8 mr-3 rounded-full md:block">
                    <img class="object-cover w-full h-full rounded-full"
                      src="https://images.unsplash.com/flagged/photo-1570612861542-284f4c12e75f?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=200&fit=max&ixid=eyJhcHBfaWQiOjE3Nzg0fQ"
                      alt="" loading="lazy" />
                    <div class="absolute inset-0 rounded-full shadow-inner" aria-hidden="true"></div>
                  </div>
                  <div>
                    <p class="font-semibold"> ${news[i].title}</p>
                    <p class="text-xs text-gray-600 dark:text-gray-400">
                      ${news[i].description}
                    </p>
                  </div>
                </div>
              </td>
              <td class="px-4 py-3 text-xs">
                <span
                  class="px-2 py-1 font-semibold leading-tight text-green-700 bg-green-100 rounded-full dark:bg-green-700 dark:text-green-100">
                    ${news[i].priority}
                  <a href="/" style="color:#7e3af2;margin-left: 18px;font-size: small;">View &#8594</a>
                </span>
              </td>
            </tr>`
    }
  }
  function updateAlbumData(){
      document.getElementById("processed-album").innerText = userData.processed
      document.getElementById("final-album").innerText = userData.final
      document.getElementById("total-album").innerText = userData.total


  }
  const getAllDrafts = async () => {
    await fetch('/album-drafts').then(response => {
      if (response.ok) {
        return response.json()
      }
    }).then(async (data) => {
      if (data.album) {
        DraftArray = data.album;
        updateTableData()
        updateTableOfCorrection()
        console.log("response data", DraftArray)
      }
    }).catch((error) => {
      console.error(error)
    });
  }
  const getUserAlbumDetails = async () => {
    await fetch('/album-manage/user-data').then(response => {
      if (response.ok) {
        return response.json()
      }
    }).then(async (data) => {
      if (data.userData) {
        userData = data.userData;
        updateAlbumData()
        console.log("response data", userData)
      }
    }).catch((error) => {
      console.error(error)
    });
  }
  const getNews = async () => {
    await fetch('/get-news').then(response => {
      if (response.ok) {
        return response.json()
      }
    }).then(async (data) => {
      if (data.news) {
        news = data.news;
        updateNews()
        console.log("response data", news)
      }
    }).catch((error) => {
      console.error(error)
    });
  }
getUserAlbumDetails()
getAllDrafts()
getNews()
</script>